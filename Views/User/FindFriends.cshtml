@model UserListView
@{
	ViewData["Title"] = "User Home Page";
}

<div class="text-center">
	<div class="jumbotron">
		<h2>Manage your friends</h2>
	</div>
	<div class="row">
		<div class="col-md-4">
			<h3>Instructions</h3>
			<p>
				Here you can send a friends request to other users so you can share lists with them!
			</p>
		</div>
		<div class="col-md-4">
			<h3>Send a friend request!</h3>
			@foreach (var item in Model.UserList)
			{
				<span>@Html.DisplayFor(modelItem => item.Email)</span> <a href='javascript: void (0);' onclick="addFriend('@item.Email')">Add</a><br />
			}

		</div>
		<div class="col-md-4">
			<h5>People you wish to befriend.</h5> <br />
			<div id="addedFriends"></div>
			<br />
			<input type="button" value="Send friend requests" onclick="submitForm()" class="btn btn-primary btn-sm" id="submitBtn" style="display:none" />
			<br />

		</div>
	</div>
	<div class="row">
		<div class="col">
			<h5>Your friends.</h5> <br />
			<div id="myFriends">
				<p>kek</p>
			</div>
		</div>
		<div class="col">
			<h5>Incoming friend requests.</h5> <br />
			<div id="myFriendRequests">
			<p>kek</p>
			</div>
		</div>
	</div>
	</div>
	@section Scripts {
		@{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
	}
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>


	<script type="text/javascript" language="javascript">
		var nameArr = [];
		var friendArr = [];
		var counter = 0;
		var myFriendCounter = 0;

		function addFriend(email) {
			nameArr.push(email);
			$("#addedFriends").append(email + "<a href='javascript: void (0);' onclick='undoMyRequest(" + counter + ");''> remove </a>" + "<br>");
			counter++;
			document.getElementById("submitBtn").style = "";
		}

		function undoMyRequest(c) {
			nameArr.splice(c, 1);
			document.getElementById("addedFriends").innerHTML = "";
			counter = 0;

			nameArr.forEach((i) => {
				$("#addedFriends").append(i + "<a href='javascript: void (0);' onclick='undoMyRequest(" + counter + ");''> remove </a>" + "<br>");
				counter++;
			})
			if (counter == 0) {
				document.getElementById("submitBtn").style = "display:none";
			}
		}

		function removeFriend(c) {
			friendArr.splice(c, 1);
			document.getElementById("myFriends").innerHTML = "";
			myFriendCounter = 0;

			nameArr.forEach((i) => {
				$("#myFriends").append(i + "<a href='javascript: void (0);' onclick='undoMyRequest(" + myFriendCounter + ");''> remove </a>" + "<br>");
				myFriendCounter++;
			});
				
		}
		function submitForm() {
			$.ajax({
				type: "POST",
				url: '/User/AddFriends',
				data: { friendlist: JSON.stringify(nameArr) },
				success: function (data) {
					alert("Success");
				},
				failure: function (errMsg) {
					alert(errMsg);
				}
			});
		}
	</script>
